<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Markdown è½¬ A4 (æ— å¤šä½™ç™½é¡µç‰ˆ)</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* ---------- å…¨å±€åŸºç¡€ ---------- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body {
            margin: 0; padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            height: 100vh;
            overflow: hidden; /* å±å¹•æµè§ˆæ—¶é˜²æ­¢åŒæ»šåŠ¨æ¡ */
        }

        /* ---------- å¸ƒå±€å®¹å™¨ ---------- */
        .container {
            display: flex;
            width: 100%;
            height: 100%;
        }

        /* ---------- å·¦ä¾§ï¼šç¼–è¾‘å™¨ ---------- */
        .editor-pane {
            width: 40%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: #2d2d2d;
            border-right: 1px solid #444;
            z-index: 10;
        }

        .toolbar {
            padding: 10px 15px;
            background: #1e1e1e;
            color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 50px;
            flex-shrink: 0;
        }
        .toolbar h1 { margin: 0; font-size: 16px; }

        textarea {
            flex: 1;
            width: 100%;
            background: #2d2d2d;
            color: #e0e0e0;
            border: none;
            padding: 15px;
            resize: none;
            font-size: 16px;
            line-height: 1.6;
            outline: none;
            font-family: monospace;
        }

        /* ---------- å³ä¾§ï¼šé¢„è§ˆåŒº ---------- */
        .preview-pane {
            flex: 1;
            background: #525659;
            overflow: auto;
            display: flex;
            justify-content: center;
            padding: 30px 10px;
        }

        /* A4 çº¸å¼ æ¨¡æ‹Ÿ (å±å¹•æ˜¾ç¤ºç”¨) */
        .a4-page {
            width: 210mm;
            min-height: 297mm; /* å±å¹•ä¸Šæ˜¾ç¤ºé«˜åº¦ï¼Œæ‰“å°æ—¶ä¼šè¦†ç›–æ­¤å±æ€§ */
            background: white;
            padding: 20mm;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            color: #000;
            flex-shrink: 0; 
        }

        /* æŒ‰é’®ä¸ FAB */
        .btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
        }
        .fab-toggle {
            display: none;
            position: fixed; bottom: 20px; right: 20px;
            width: 56px; height: 56px; border-radius: 50%;
            background: #007bff; color: white; border: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            font-size: 24px; z-index: 100;
            justify-content: center; align-items: center; cursor: pointer;
        }

        /* ---------- ç§»åŠ¨ç«¯é€‚é… ---------- */
        @media screen and (max-width: 768px) {
            .container { display: block; }
            .editor-pane, .preview-pane { width: 100%; height: 100%; position: absolute; top:0; left:0; }
            .preview-pane { transform: translateX(100%); transition: transform 0.3s ease; z-index: 20; padding: 10px; align-items: flex-start; }
            body.show-preview .preview-pane { transform: translateX(0); }
            .fab-toggle { display: flex; }
            .a4-page { transform-origin: top center; margin-bottom: 50px; }
        }

        /* ---------- Markdown æ ·å¼ ---------- */
        .markdown-body { line-height: 1.6; font-size: 11pt; }
        .markdown-body h1 { border-bottom: 2px solid #eaecef; padding-bottom: 0.3em; margin-top: 0; }
        .markdown-body img { max-width: 100%; }
        .markdown-body pre { background: #f6f8fa; padding: 10px; overflow: auto; }
        .markdown-body table { border-collapse: collapse; width: 100%; margin-bottom: 1em; }
        .markdown-body th, .markdown-body td { border: 1px solid #dfe2e5; padding: 6px 13px; }

        /* =========================================
           é‡ç‚¹ä¿®å¤ï¼šæ‰“å°æ ·å¼ (å®Œç¾æ¶ˆé™¤ç©ºç™½é¡µ)
           ========================================= */
        @media print {
            /* 1. éšè—æ‰€æœ‰æ— å…³å…ƒç´  */
            .editor-pane, .toolbar, .fab-toggle { display: none !important; }

            /* 2. é‡ç½® HTML/Body é«˜åº¦å’Œæ»šåŠ¨ */
            html, body {
                height: auto !important;
                overflow: visible !important;
                background: #fff !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            /* 3. é‡ç½®å¸ƒå±€å®¹å™¨ */
            .container, .preview-pane {
                display: block !important;
                height: auto !important;
                width: 100% !important;
                position: static !important;
                overflow: visible !important;
                background: #fff !important;
                padding: 0 !important;
                margin: 0 !important;
                transform: none !important; /* é˜²æ­¢ç§»åŠ¨ç«¯åç§» */
            }

            /* 4. è°ƒæ•´ A4 çº¸å®¹å™¨ï¼šæ ¸å¿ƒä¿®å¤ç‚¹ */
            .a4-page {
                width: 100% !important; /* å®½åº¦è·Ÿéšçº¸å¼  */
                min-height: 0 !important; /* ã€å…³é”®ã€‘å–æ¶ˆæœ€å°é«˜åº¦ï¼Œé˜²æ­¢æ’‘å¼€ */
                height: auto !important;  /* æ ¹æ®å†…å®¹è‡ªé€‚åº” */
                margin: 0 !important;
                padding: 0 !important;    /* ã€å…³é”®ã€‘ç”± @page æ§åˆ¶è¾¹è· */
                box-shadow: none !important;
                border: none !important;
            }

            /* 5. è®¾ç½®æ‰“å°æœºé¡µé¢å±æ€§ */
            @page {
                size: A4;
                margin: 20mm; /* ã€å…³é”®ã€‘è®©æµè§ˆå™¨æ§åˆ¶è¾¹è·ï¼Œå†…å®¹åŒºä¼šè‡ªåŠ¨å˜å° */
            }

            /* 6. é˜²æ­¢æœ€åä¸€ä¸ªå…ƒç´ çš„ margin æŒ¤å‡ºæ–°çš„ä¸€é¡µ */
            .markdown-body > *:last-child {
                margin-bottom: 0 !important;
                padding-bottom: 0 !important;
            }
            
            /* 7. é¿å…å…ƒç´ å†…éƒ¨è¢«åˆ†é¡µåˆ‡æ–­ */
            pre, blockquote, table, img {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="editor-pane">
        <div class="toolbar">
            <h1>ğŸ“ è¾“å…¥å†…å®¹</h1>
            <button class="btn" onclick="window.print()">æ‰“å°/PDF</button>
        </div>
        <textarea id="markdown-input" placeholder="è¯·è¾“å…¥ Markdown..."></textarea>
    </div>

    <div class="preview-pane">
        <div class="toolbar" style="width: 100%; position: absolute; top:0; left:0; background: rgba(30,30,30,0.9); z-index: 50; display: none;" id="mobile-preview-bar">
            <h1>ğŸ“„ é¢„è§ˆæ•ˆæœ</h1>
            <button class="btn" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°</button>
        </div>
        <div id="a4-output" class="a4-page markdown-body"></div>
    </div>
</div>

<button class="fab-toggle" id="toggle-btn" onclick="toggleView()">ğŸ‘ï¸</button>

<script>
    const input = document.getElementById('markdown-input');
    const output = document.getElementById('a4-output');
    const body = document.body;
    const toggleBtn = document.getElementById('toggle-btn');
    const mobilePreviewBar = document.getElementById('mobile-preview-bar');

    const defaultText = `# æ‰“å°å®Œç¾ç‰ˆ

ä¿®å¤äº†â€œå¤šå‡ºä¸€é¡µç™½çº¸â€çš„é—®é¢˜ã€‚

## ä¿®å¤åŸç†
æˆ‘ä»¬ç§»é™¤äº†æ‰“å°æ—¶çš„å›ºå®šé«˜åº¦é™åˆ¶ï¼Œå¹¶è®©æµè§ˆå™¨æ¥ç®¡é¡µé¢è¾¹è·ã€‚

1. **å†™æ»¡è¿™ä¸€é¡µ**ï¼šä½ å¯ä»¥å°è¯•å¤šå¤åˆ¶è¿™æ®µæ–‡å­—ï¼Œå¡«æ»¡é¡µé¢ã€‚
2. **åªæœ‰ä¸€é¡µ**ï¼šå¦‚æœå†…å®¹ä¸è¶³ä¸€é¡µï¼Œç°åœ¨æ‰“å°ç»å¯¹ä¸ä¼šå‡ºç°ç¬¬äºŒå¼ ç™½çº¸ã€‚

---
æµ‹è¯•åˆ—è¡¨ï¼š
- é¡¹ç›® 1
- é¡¹ç›® 2
`;

    input.value = defaultText;

    function render() {
        // .trim() å»é™¤é¦–å°¾ç©ºæ ¼ï¼Œé˜²æ­¢æœ€åçš„æ¢è¡Œç¬¦äº§ç”Ÿç©ºæ®µè½
        const text = input.value.trim(); 
        output.innerHTML = marked.parse(text);
    }

    input.addEventListener('input', render);
    render();

    function toggleView() {
        body.classList.toggle('show-preview');
        if (body.classList.contains('show-preview')) {
            toggleBtn.innerHTML = 'âœï¸';
            if(window.innerWidth <= 768) mobilePreviewBar.style.display = 'flex';
        } else {
            toggleBtn.innerHTML = 'ğŸ‘ï¸';
            mobilePreviewBar.style.display = 'none';
        }
    }
    
    window.addEventListener('resize', () => {
        if (window.innerWidth > 768) mobilePreviewBar.style.display = 'none';
        else if (body.classList.contains('show-preview')) mobilePreviewBar.style.display = 'flex';
    });
</script>
</body>
</html>