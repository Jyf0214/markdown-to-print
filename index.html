<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Markdown A4 å®Œç¾é€‚é…</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* ---------- åŸºç¡€é‡ç½® ---------- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html {
            margin: 0; padding: 0;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f2f4f7;
            overflow: hidden; /* ç¦æ­¢æ•´ä½“æ»šåŠ¨ï¼Œç”±å†…éƒ¨åŒºåŸŸæ¥ç®¡ */
        }

        /* ---------- å¸ƒå±€ç»“æ„ ---------- */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        /* 1. ç¼–è¾‘å™¨åŒºåŸŸ */
        .editor-area {
            flex: 1;
            display: flex; /* é»˜è®¤æ˜¾ç¤º */
            flex-direction: column;
            background: #fff;
        }

        textarea {
            flex: 1;
            width: 100%;
            border: none;
            padding: 20px;
            font-size: 16px;
            line-height: 1.6;
            resize: none;
            outline: none;
            color: #333;
            background: #fff;
        }

        /* 2. é¢„è§ˆåŒºåŸŸ */
        .preview-area {
            flex: 1;
            display: none; /* é»˜è®¤éšè— */
            background: #525659; /* æ·±ç°èƒŒæ™¯ï¼Œçªå‡ºç™½çº¸ */
            overflow-y: auto;
            align-items: flex-start;
            justify-content: center;
            padding-top: 20px;
            padding-bottom: 80px; /* ç»™åº•éƒ¨æ ç•™ç©ºé—´ */
        }

        /* A4 çº¸å¼ å®¹å™¨ */
        .a4-scaler {
            /* è¿™é‡Œåˆ©ç”¨ CSS ç¼©æ”¾ï¼Œç¨åç”¨ JS åŠ¨æ€è®¡ç®— scale å€¼ */
            transform-origin: top center;
            transition: transform 0.2s ease;
        }

        .a4-page {
            width: 210mm; /* ç‰©ç†å®½åº¦ */
            min-height: 297mm;
            background: white;
            padding: 20mm;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            color: #000;
        }

        /* 3. åº•éƒ¨å›ºå®šæ“ä½œæ  (æ›¿ä»£æ‚¬æµ®çƒ) */
        .bottom-bar {
            height: 60px;
            background: #fff;
            border-top: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }

        .status-text {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .action-group {
            display: flex;
            gap: 10px;
        }

        .btn {
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        .btn-primary { background: #007bff; color: #fff; }
        .btn-secondary { background: #f0f0f0; color: #333; }
        .btn-ghost { background: transparent; color: #007bff; }

        /* ---------- çŠ¶æ€åˆ‡æ¢ ---------- */
        /* é¢„è§ˆæ¨¡å¼ä¸‹çš„æ ·å¼è¦†å†™ */
        body.mode-preview .editor-area { display: none; }
        body.mode-preview .preview-area { display: flex; }

        /* ---------- Markdown æ¸²æŸ“å¾®è°ƒ ---------- */
        .markdown-body { font-size: 11pt; line-height: 1.6; }
        .markdown-body h1 { border-bottom: 2px solid #eee; padding-bottom: 10px; font-size: 24px; margin-top: 0; }
        .markdown-body h2 { border-bottom: 1px solid #eee; padding-bottom: 8px; font-size: 20px; }
        .markdown-body table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        .markdown-body th, .markdown-body td { border: 1px solid #ddd; padding: 8px; }
        .markdown-body img { max-width: 100%; }
        .markdown-body pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: hidden; white-space: pre-wrap; word-wrap: break-word; }

        /* ---------- æ‰“å°ä¸“ç”¨ (ä¿®å¤ç™½é¡µã€å°ºå¯¸) ---------- */
        @media print {
            .editor-area, .bottom-bar { display: none !important; }
            .preview-area { 
                display: block !important; 
                overflow: visible !important; 
                background: white !important; 
                padding: 0 !important; 
                margin: 0 !important; 
            }
            
            .a4-scaler {
                transform: none !important; /* æ‰“å°æ—¶å¿…é¡»è¿˜åŸç¼©æ”¾ï¼Œä¿è¯1:1 */
                width: 100% !important;
                margin: 0 !important;
            }

            .a4-page {
                box-shadow: none !important;
                margin: 0 !important;
                width: 100% !important;
                padding: 0 !important; /* è®© @page æ§åˆ¶è¾¹è· */
                min-height: 0 !important;
            }

            /* æ ¸å¿ƒï¼šäº¤å‡ºæ§åˆ¶æƒç»™æ‰“å°æœº */
            @page {
                size: A4;
                margin: 20mm;
            }
        }
    </style>
</head>
<body>

<div class="app-container">
    
    <!-- ç¼–è¾‘å™¨ -->
    <div class="editor-area">
        <textarea id="input" placeholder="è¯·åœ¨æ­¤å¤„è¾“å…¥ Markdown å†…å®¹..."></textarea>
    </div>

    <!-- é¢„è§ˆå™¨ -->
    <div class="preview-area" id="previewContainer">
        <div class="a4-scaler" id="scaler">
            <div id="output" class="a4-page markdown-body"></div>
        </div>
    </div>

    <!-- åº•éƒ¨æ  -->
    <div class="bottom-bar">
        <div class="status-text" id="statusLabel">æ­£åœ¨ç¼–è¾‘</div>
        <div class="action-group">
            <!-- ç¼–è¾‘æ¨¡å¼æ˜¾ç¤º -->
            <button class="btn btn-primary" id="btnToPreview" onclick="switchMode('preview')">é¢„è§ˆæ•ˆæœ</button>
            
            <!-- é¢„è§ˆæ¨¡å¼æ˜¾ç¤º (é»˜è®¤éšè—) -->
            <button class="btn btn-secondary" id="btnToEdit" onclick="switchMode('edit')" style="display:none;">è¿”å›ç¼–è¾‘</button>
            <button class="btn btn-primary" id="btnPrint" onclick="window.print()" style="display:none;">ğŸ–¨ï¸ æ‰“å°/å­˜PDF</button>
        </div>
    </div>
</div>

<script>
    const input = document.getElementById('input');
    const output = document.getElementById('output');
    const scaler = document.getElementById('scaler');
    const statusLabel = document.getElementById('statusLabel');
    const btnToPreview = document.getElementById('btnToPreview');
    const btnToEdit = document.getElementById('btnToEdit');
    const btnPrint = document.getElementById('btnPrint');
    
    // é»˜è®¤æ–‡æœ¬
    const defaultText = `# å®Œç¾é€‚é…ç‰ˆ

ä¸å†éœ€è¦å·¦å³æ»‘åŠ¨ã€‚

## ä»€ä¹ˆæ˜¯è‡ªåŠ¨é€‚é…ï¼Ÿ
æˆ‘ä»¬é€šè¿‡ç®—æ³•è®¡ç®—ä½ çš„æ‰‹æœºå±å¹•å®½åº¦ï¼Œè‡ªåŠ¨å°† A4 çº¸å¼  **"ç¼©å°"** åˆ°åˆšå¥½èƒ½æ”¾è¿›ä½ çš„å±å¹•ã€‚

- **æ‰€è§å³æ‰€å¾—**ï¼šè™½ç„¶å±å¹•ä¸Šçœ‹ç€å­—å°ï¼Œä½†æ¢è¡Œä½ç½®å’Œæœ€ç»ˆæ‰“å°æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚
- **æ“ä½œèˆ’é€‚**ï¼šåº•éƒ¨æŒ‰é’®ï¼Œä¸æŒ¡è§†çº¿ã€‚

## æ‰“å°æµ‹è¯•
ç‚¹å‡»å³ä¸‹è§’ **æ‰“å°** æŒ‰é’®ï¼Œé€‰æ‹© **å­˜å‚¨åˆ°æ–‡ä»¶/PDF** å³å¯ã€‚
`;

    input.value = defaultText;

    // æ¸²æŸ“ Markdown
    function render() {
        output.innerHTML = marked.parse(input.value.trim());
    }

    // æ ¸å¿ƒé€»è¾‘ï¼šè®¡ç®—ç¼©æ”¾æ¯”ä¾‹
    function fitToScreen() {
        if (!document.body.classList.contains('mode-preview')) return;

        // A4 çº¸åƒç´ å®½åº¦ (210mm @ 96dpi â‰ˆ 794px)
        const a4WidthPx = 794; 
        // æ‰‹æœºå±å¹•å®½åº¦ (å‡å»ä¸€ç‚¹è¾¹è·)
        const screenWidth = window.innerWidth - 20; 

        // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ (ä¾‹å¦‚ æ‰‹æœºå®½ 390 / A4å®½ 794 = 0.49)
        let scale = screenWidth / a4WidthPx;
        
        // é™åˆ¶æœ€å¤§ç¼©æ”¾ä¸º 1 (ç”µè„‘ç«¯ä¸æ”¾å¤§)
        if (scale > 1) scale = 1;

        // åº”ç”¨ç¼©æ”¾
        scaler.style.transform = `scale(${scale})`;
        
        // ã€å…³é”®ã€‘ç”±äº scale ç¼©å°äº†è§†è§‰å¤§å°ï¼Œä½† DOM ä¾ç„¶å æ®åŸé«˜åº¦
        // æˆ‘ä»¬éœ€è¦è°ƒæ•´çˆ¶å®¹å™¨çš„é«˜åº¦ï¼Œå»æ‰å¤šä½™çš„ç©ºç™½
        // è¿™é‡Œçš„è®¡ç®—æœ‰ç‚¹å¤æ‚ï¼Œä¸ºäº†ç®€å•ï¼Œæˆ‘ä»¬è®© margin-bottom å˜æˆè´Ÿçš„
        // æˆ–è€…ç›´æ¥ä¸ç®¡é«˜åº¦ï¼Œå› ä¸º overflow-y: auto ä¼šå¤„ç†
        
        // è°ƒæ•´ scaler çš„è¾¹è·ï¼Œè®©å®ƒåœ¨ç¼©æ”¾åä¾ç„¶å±…ä¸­
        scaler.style.marginBottom = `-${(1 - scale) * 100}%`;
    }

    // åˆ‡æ¢æ¨¡å¼
    function switchMode(mode) {
        if (mode === 'preview') {
            render(); // å…ˆæ¸²æŸ“å†…å®¹
            document.body.classList.add('mode-preview');
            
            // æ›´æ–°åº•éƒ¨æ 
            statusLabel.innerText = "é¢„è§ˆ A4 æ•ˆæœ";
            btnToPreview.style.display = 'none';
            btnToEdit.style.display = 'block';
            btnPrint.style.display = 'block';

            // è§¦å‘ç¼©æ”¾è®¡ç®—
            setTimeout(fitToScreen, 10); // å»¶æ—¶ä¸€ç‚¹ç¡®ä¿ display:flex ç”Ÿæ•ˆ

        } else {
            document.body.classList.remove('mode-preview');
            
            // æ›´æ–°åº•éƒ¨æ 
            statusLabel.innerText = "æ­£åœ¨ç¼–è¾‘";
            btnToPreview.style.display = 'block';
            btnToEdit.style.display = 'none';
            btnPrint.style.display = 'none';
        }
    }

    input.addEventListener('input', render);
    
    // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼ˆæ—‹è½¬å±å¹•æ—¶è‡ªåŠ¨é‡ç®—ï¼‰
    window.addEventListener('resize', fitToScreen);

    // åˆå§‹åŒ–æ¸²æŸ“ä¸€æ¬¡
    render();
</script>

</body>
</html>