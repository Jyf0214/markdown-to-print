<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Markdown A4 å¤šé¡µä¿®å¤ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* ---------- åŸºç¡€æ ·å¼ (å±å¹•æµè§ˆç”¨) ---------- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        html, body {
            margin: 0; padding: 0;
            height: 100%; /* å±å¹•ä¸Šå æ»¡å…¨å± */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f2f4f7;
            overflow: hidden; /* å±å¹•ä¸Šç¦æ­¢æ•´ä½“æ»šåŠ¨ */
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        /* ç¼–è¾‘å™¨ */
        .editor-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #fff;
            overflow: hidden;
        }

        textarea {
            flex: 1;
            width: 100%;
            border: none;
            padding: 20px;
            font-size: 16px;
            line-height: 1.6;
            resize: none;
            outline: none;
            background: #fff;
            color: #333;
        }

        /* é¢„è§ˆåŒº */
        .preview-area {
            flex: 1;
            display: none; /* é»˜è®¤éšè— */
            background: #525659;
            overflow-y: auto; /* å±å¹•ä¸Šå…è®¸å†…éƒ¨æ»šåŠ¨ */
            align-items: flex-start;
            justify-content: center;
            padding-top: 20px;
            padding-bottom: 80px;
        }

        /* ç¼©æ”¾å®¹å™¨ */
        .a4-scaler {
            transform-origin: top center;
            transition: transform 0.2s ease;
        }

        /* çº¸å¼ æœ¬ä½“ */
        .a4-page {
            width: 210mm;
            min-height: 297mm;
            background: white;
            padding: 20mm;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            color: #000;
            /* å…³é”®ï¼šè®©å†…å®¹æ’‘å¼€é«˜åº¦ï¼Œè€Œä¸æ˜¯å›ºå®š */
            height: auto; 
        }

        /* åº•éƒ¨æ“ä½œæ  */
        .bottom-bar {
            height: 60px;
            background: #fff;
            border-top: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
            flex-shrink: 0; /* é˜²æ­¢è¢«æŒ¤å‹ */
        }
        
        /* çŠ¶æ€ä¸æŒ‰é’® */
        .status-text { font-size: 14px; color: #666; font-weight: 500; }
        .action-group { display: flex; gap: 10px; }
        .btn { border: none; border-radius: 6px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer; }
        .btn-primary { background: #007bff; color: #fff; }
        .btn-secondary { background: #f0f0f0; color: #333; }

        /* é¢„è§ˆæ¨¡å¼åˆ‡æ¢ */
        body.mode-preview .editor-area { display: none; }
        body.mode-preview .preview-area { display: flex; }

        /* Markdown æ ·å¼ */
        .markdown-body { font-size: 11pt; line-height: 1.6; }
        .markdown-body h1 { border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 20px; }
        .markdown-body table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        .markdown-body th, .markdown-body td { border: 1px solid #ddd; padding: 8px; }
        .markdown-body pre { background: #f8f9fa; padding: 10px; white-space: pre-wrap; word-wrap: break-word; }
        .markdown-body img { max-width: 100%; }

        /* ==============================================
           å…³é”®ä¿®å¤ï¼šæ‰“å°æ ·å¼ (ä¿®å¤å¤šé¡µæˆªæ–­)
           ============================================== */
        @media print {
            /* 1. å½»åº•éšè— UI å…ƒç´  */
            .editor-area, .bottom-bar, .action-group { display: none !important; }

            /* 2. å¼ºåˆ¶é‡ç½® HTML/Body é«˜åº¦å’Œæº¢å‡º */
            html, body {
                height: auto !important;
                min-height: 0 !important;
                overflow: visible !important; /* å…è®¸æ»šåŠ¨/ç¿»é¡µ */
                background: white !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            /* 3. é‡ç½®å¸ƒå±€å®¹å™¨ï¼Œå–æ¶ˆ Flexbox */
            .app-container {
                display: block !important;
                height: auto !important;
                overflow: visible !important;
            }

            /* 4. é‡ç½®é¢„è§ˆåŒº */
            .preview-area {
                display: block !important;
                height: auto !important;
                overflow: visible !important;
                background: white !important;
                padding: 0 !important;
                margin: 0 !important;
            }

            /* 5. ç¦ç”¨ç¼©æ”¾ï¼Œä¿è¯æ‰“å°æ¸…æ™°åº¦å’Œå®Œæ•´æ€§ */
            .a4-scaler {
                transform: none !important;
                width: 100% !important;
                height: auto !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            /* 6. çº¸å¼ æ ·å¼è°ƒæ•´ï¼šå…è®¸æ— é™å»¶ä¼¸ */
            .a4-page {
                width: 100% !important;
                height: auto !important; /* è®©å†…å®¹å†³å®šé«˜åº¦ */
                min-height: 0 !important;
                margin: 0 !important;
                padding: 0 !important; /* è¾¹è·äº¤ç»™ @page */
                box-shadow: none !important;
                border: none !important;
            }

            /* 7. æ‰“å°æœºè®¾ç½®ï¼šç”±æ‰“å°æœºæ¥ç®¡åˆ†é¡µ */
            @page {
                size: A4;
                margin: 20mm; /* ä¸Šä¸‹å·¦å³ç•™ç™½ */
            }

            /* 8. ä¼˜åŒ–åˆ†é¡µé€»è¾‘ (é˜²æ­¢æ ‡é¢˜æˆ–è¡¨æ ¼è¢«åˆ‡æ–­) */
            h1, h2, h3 { page-break-after: avoid; }
            table, pre, blockquote { page-break-inside: avoid; }
        }
    </style>
</head>
<body>

<div class="app-container">
    <div class="editor-area">
        <textarea id="input" placeholder="è¾“å…¥ Markdown..."></textarea>
    </div>

    <div class="preview-area" id="previewContainer">
        <div class="a4-scaler" id="scaler">
            <div id="output" class="a4-page markdown-body"></div>
        </div>
    </div>

    <div class="bottom-bar">
        <div class="status-text" id="statusLabel">ç¼–è¾‘ä¸­</div>
        <div class="action-group">
            <button class="btn btn-primary" id="btnToPreview" onclick="switchMode('preview')">é¢„è§ˆ</button>
            <button class="btn btn-secondary" id="btnToEdit" onclick="switchMode('edit')" style="display:none;">ç¼–è¾‘</button>
            <button class="btn btn-primary" id="btnPrint" onclick="window.print()" style="display:none;">ğŸ–¨ï¸ æ‰“å°</button>
        </div>
    </div>
</div>

<script>
    const input = document.getElementById('input');
    const output = document.getElementById('output');
    const scaler = document.getElementById('scaler');
    const statusLabel = document.getElementById('statusLabel');
    const btnToPreview = document.getElementById('btnToPreview');
    const btnToEdit = document.getElementById('btnToEdit');
    const btnPrint = document.getElementById('btnPrint');

    // ç”Ÿæˆå¤§é‡æµ‹è¯•æ–‡æœ¬ä»¥éªŒè¯å¤šé¡µæ‰“å°
    let longText = "# å¤šé¡µæ‰“å°æµ‹è¯•\n\næ­¤æ–‡æ¡£ç”¨äºæµ‹è¯•é•¿å†…å®¹æ˜¯å¦ä¼šè¢«æˆªæ–­ã€‚\n\n";
    for(let i=1; i<=50; i++) {
        longText += `### ç¬¬ ${i} ç« èŠ‚\nè¿™æ˜¯ä¸€æ®µæµ‹è¯•æ–‡å­—ï¼Œç”¨äºå¡«å……é¡µé¢é«˜åº¦ï¼Œç¡®ä¿èƒ½å¤Ÿæ­£ç¡®æ‰“å°å‡ºå¤šå¼ çº¸ã€‚å¦‚æœåªèƒ½æ‰“å°ç¬¬ä¸€é¡µï¼Œè¯´æ˜ overflow è®¾ç½®æœ‰é—®é¢˜ã€‚\n\n`;
    }

    input.value = longText;

    function render() {
        output.innerHTML = marked.parse(input.value);
    }

    // å±å¹•é€‚é…ç®—æ³• (ä»…å½±å“è§†è§‰é¢„è§ˆï¼Œä¸å½±å“æ‰“å°)
    function fitToScreen() {
        if (!document.body.classList.contains('mode-preview')) return;
        const a4WidthPx = 794; 
        const screenWidth = window.innerWidth - 20; 
        let scale = screenWidth / a4WidthPx;
        if (scale > 1) scale = 1;

        scaler.style.transform = `scale(${scale})`;
        scaler.style.marginBottom = `-${(1 - scale) * 100}%`;
    }

    function switchMode(mode) {
        if (mode === 'preview') {
            render();
            document.body.classList.add('mode-preview');
            statusLabel.innerText = "é¢„è§ˆæ¨¡å¼";
            btnToPreview.style.display = 'none';
            btnToEdit.style.display = 'block';
            btnPrint.style.display = 'block';
            setTimeout(fitToScreen, 10);
        } else {
            document.body.classList.remove('mode-preview');
            statusLabel.innerText = "ç¼–è¾‘ä¸­";
            btnToPreview.style.display = 'block';
            btnToEdit.style.display = 'none';
            btnPrint.style.display = 'none';
        }
    }

    input.addEventListener('input', render);
    window.addEventListener('resize', fitToScreen);
    render();
</script>
</body>
</html>
